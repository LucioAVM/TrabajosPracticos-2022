/*
 * controller.c
 *
 *  Created on: 9 jun. 2022
 *      Author: UGIO
 */

#include <stdio.h>
#include <stdlib.h>
#include "parser.h"
#include "LinkedList.h"
#include "Pasajero.h"
#include "Estado.h"
#include "TipoPasajero.h"

int mostrarMenu(void)
{
	int menu;
	int bandera;

	bandera = 0;

	do
	{
		if(bandera > 0)
		{
			printf("Error, ingrese una opcion valida:/n/n");
		}
		printf("       Menu Pasajeros/n"
			   "       --------------/n/n"
		     "1. Cargar datos en texto/n"
		     "2. Cargar datos en binario/n"
		     "3. Alta/n"
		     "4. Modificar/n"
		     "5. Baja/n"
		     "6. Listar/n"
		     "7. Ordenar/n"
		     "8. Guardar datos en texto/n"
		     "9. Guardar datos en binario/n"
		    "10. Salir/n"
		    "/t/tOpcion:");
			fflush(stdout);
			scanf("%d",&menu);

			bandera++;
	}while(menu <= 10 && menu >= 1 );

	return menu;
}


/** \brief Carga los datos de los pasajeros desde el archivo data.csv (modo texto).
 *
 * \param path char*
 * \param pArrayListPassenger LinkedList*
 * \return int
 *
 */
int controller_cargarDesdeTexto(char* path , LinkedList* pArrayListPassenger[])
{
	FILE* pArchivo = NULL;

	pArchivo = fopen(path,"r");

	if(pArchivo == NULL)
	{
		printf("error");
	}else{
		parser_PasajeroDesdeTexto(pArchivo, pArrayListPassenger);
	}
	fclose(pArchivo);

    return 1;
}

/** \brief Carga los datos de los pasajeros desde el archivo data.csv (modo binario).
 *
 * \param path char*
 * \param pArrayListPassenger LinkedList*
 * \return int
 *
 */
int controller_cargarDesdeBinario(char* path , LinkedList* pArrayListPassenger)
{
    int retorno;

    retorno = -1;

    FILE* pArchivo;

    if(path != NULL && pArrayListPassenger != NULL)
    {
    	pArchivo = fopen(path,"rb");
        if(pArchivo != NULL)
        {
            retorno = parser_PasajeroDesdeBinadio(pArchivo,pArrayListPassenger);
            fclose(pArchivo);
        }
    }
    return retorno;
}

/** \brief Alta de pasajero
 *
 * \param path char*
 * \param pArrayListPassenger LinkedList*
 * \return int
 *
 */
int controller_altaPasajero(LinkedList* pArrayListPassenger)
{
	ePasajero* pasajero;

	int id;
	char nombre[50];
	char apellido[50];
	float precio;
	int tipoPasajero;
	char codigoVuelo[4];
	int estado;

	int validacionNombre;
	int validacionApellido;
	int validacionHorasTrabajadas;
	int validacionSueldo;

	int retorno;

	pasajero = NULL;
	retorno = -1;

	if(pArrayListPassenger != NULL)
	{
		//PIDE DATOS DEL PASAJERO AL USUARIO

												 //NOMBRE
		validacionNombre = getStringLetras("\n\nIngresar nombre del pasajero:\t", nombre);
		if(validacionNombre == -1)
		{
			printf("\n\nERROR, no se pudo ingresar correctamente el nombre \n");
		}

												//APELLIDO
		validacionApellido = getStringLetras("\n\nIngresar apellido del pasajero:\t", apellido);
		if(validacionApellido == -1)
		{
			printf("\nERROR, no se pudo ingresar correctamente el apellido \n");
		}

											//PRECIO DE VUELO
		getFloat(&precio, "\n\nIngresar precio del vuelo:\t", "\nERROR, Ingresar precio del vuelo:\t",0,1000000, 5);

											//TIPO DE PASAJERO
		tipoPasajero = getInt("\n\nIngrese tipo de pasajero:\t","\nERROR, Ingrese tipo de pasajero:\t", 0,5,5);

											//CODIGO DE VUELO
		getString("\n\nIngrese codigo del vuelo: \t", codigoVuelo);

											//ESTADO DEL VUELO
		estado = getInt("\n\nIngrese estado del vuelo\t","\nERROR, Ingrese estado del vuelo\t", 0, 3, 5);


		pasajero = ePasajero_new();
		id = cargar_nuevoId();


		pasajero = ePasajero_newParametros(id, nombre, apellido, precio, tipoPasajero, codigoVuelo, estado);
	}
    return 1;//VALIDAR QUE ESTE ABIERTO EL ARCHIVO ANTES
}

/** \brief Modificar datos de pasajero
 *
 * \param path char*
 * \param pArrayListPassenger LinkedList*
 * \return int
 *
 */
int controller_modificarPasajero(LinkedList* pArrayListPassenger)
{
    return 1;
}

/** \brief Baja de pasajero
 *
 * \param path char*
 * \param pArrayListPassenger LinkedList*
 * \return int
 *
 */
int controller_bajaPasajero(LinkedList* pArrayListPassenger)
{
    return 1;
}

/** \brief Listar pasajeros
 *
 * \param path char*
 * \param pArrayListPassenger LinkedList*
 * \return int
 *
 */
int controller_ListarPasajeros(LinkedList* pArrayListPassenger)
{
    return 1;
}

/** \brief Ordenar pasajeros
 *
 * \param path char*
 * \param pArrayListPassenger LinkedList*
 * \return int
 *
 */
int controller_ordenarPasajeros(LinkedList* pArrayListPassenger)
{
    return 1;
}

/** \brief Guarda los datos de los pasajeros en el archivo data.csv (modo texto).
 *
 * \param path char*
 * \param pArrayListPassenger LinkedList*
 * \return int
 *
 */
int controller_GuardarComoTexto(char* path , LinkedList* pArrayListPassenger)
{
	int retorno;

	FILE* pArchivoTexto;
	ePasajero* pasajero;
	int tam;
	int i;

	retorno = -1;
	tam = ll_len(pArrayListPassenger);

	if(path != NULL && pArrayListPassenger !=NULL)
	{
		pArchivoTexto = fopen(path,"w");

		if(pArchivoTexto !=NULL)
		{
			for(i=0;i<tam;i++)
			{
				pasajero = (ePasajero*)ll_get(pArrayListPassenger,i);
				fwrite(pasajero,sizeof(ePasajero),1,pArchivoTexto);
			}
		}
		fclose(pArchivoTexto);
		retorno = 0;
	}
	return retorno;
}


/** \brief Guarda los datos de los pasajeros en el archivo data.csv (modo binario).
 *
 * \param path char*
 * \param pArrayListPassenger LinkedList*
 * \return int
 *
 */
int controller_GuardarComoBinario(char* path , LinkedList* pArrayListPassenger)
{
	int retorno;
	FILE* pArchivoBinario;
	ePasajero* pasajero;
	int tam;
	int i;


	retorno = -1;
	tam = ll_len(pArrayListPassenger);

	if(path != NULL && pArrayListPassenger !=NULL)
	{
		pArchivoBinario = fopen(path,"wb");

		if(pArchivoBinario !=NULL)
		{
			for(i=0;i<tam;i++)
			{
				pasajero = (ePasajero*)ll_get(pArrayListPassenger,i);
				fwrite(pasajero,sizeof(ePasajero),1,pArchivoBinario);
			}
		}
		fclose(pArchivoBinario);
		retorno = 0;
	}
    return retorno;
}
